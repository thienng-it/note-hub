# =============================================================================
# Drone CI Environment Configuration - INDEPENDENT
# =============================================================================
# Copy this file to .env.drone and fill in your values:
#   cp .env.drone.example .env.drone
#
# ⚠️  IMPORTANT: This configuration is COMPLETELY INDEPENDENT
#
# This file (.env.drone) is SEPARATE from .env (if it exists)
# NO variables are shared with NoteHub or any other application
# Drone CI has its own GitHub OAuth App (separate credentials)
# Can be used with or without NoteHub present
# Can be deployed on a completely different server
#
# Setup Instructions:
# 1. Create a NEW GitHub OAuth App at https://github.com/settings/developers
#    (This is SEPARATE from any other OAuth apps you have)
# 2. Set Authorization callback URL to: http://your-domain:8080/login
# 3. Copy the NEW Client ID and Client Secret to this file
# 4. Generate RPC secret with: openssl rand -hex 16
# 5. Configure your server hostname (can be different from any other apps)
# =============================================================================

# =============================================================================
# Required Configuration
# =============================================================================

# GitHub OAuth Application (INDEPENDENT - Create a NEW OAuth App for Drone CI)
# Create NEW app at: https://github.com/settings/developers
# Authorization callback URL: http://your-domain:8080/login
# ⚠️ These credentials are ONLY for Drone CI - not shared with other apps
DRONE_GITHUB_CLIENT_ID=your-github-oauth-client-id
DRONE_GITHUB_CLIENT_SECRET=your-github-oauth-client-secret

# Server Configuration
# Your server's public hostname or IP (without http://)
# Examples:
#   - localhost:8080 (for local testing)
#   - drone.example.com (for production with reverse proxy)
#   - 123.45.67.89:8080 (direct IP access)
DRONE_SERVER_HOST=localhost:8080

# Protocol (http or https)
# Use 'https' in production with a reverse proxy (nginx, Caddy, Traefik)
DRONE_SERVER_PROTO=http

# RPC Secret for server-runner communication
# Generate with: openssl rand -hex 16
# IMPORTANT: Keep this secret secure!
DRONE_RPC_SECRET=generate-with-openssl-rand-hex-16

# =============================================================================
# Custom Domain Configuration (REQUIRED for production with custom domains)
# =============================================================================
# DRONE_DOMAIN: Your domain name for Drone CI (without http:// or https://)
#   - Set this to your actual domain name for SSL/HTTPS to work correctly
#   - This ensures Let's Encrypt issues certificates for the correct domain
#   - Examples: drone.yourdomain.com, ci.example.com, drone-ci.mysite.com
#   - For custom domains, also set DRONE_SERVER_PROTO=https
#   - For custom domains, set DRONE_SERVER_HOST to match this domain (without port)
#
# DRONE_ACME_EMAIL: Email address for Let's Encrypt notifications
#   - Used for certificate expiration warnings
#   - Should be a monitored email address
#
# NOTE: After setting these variables, you must also set DRONE_ROUTER_RULE (see below)
#   Prerequisites:
#   1. Ensure DNS A record points your domain to your server's IP
#   2. Ensure ports 80 and 443 are accessible from the internet
#   3. Update GitHub OAuth callback URL to use your domain
#
# Example for custom domain:
#   DRONE_DOMAIN=drone.yourdomain.com
#   DRONE_ACME_EMAIL=admin@yourdomain.com
#   DRONE_SERVER_PROTO=https
#   DRONE_SERVER_HOST=drone.yourdomain.com
#   DRONE_ROUTER_RULE=Host(`drone.yourdomain.com`)  # IMPORTANT: Set this!
#
# Leave empty for localhost/IP access (default):
DRONE_DOMAIN=
DRONE_ACME_EMAIL=admin@example.com

# =============================================================================
# DuckDNS Token (REQUIRED for DNS challenge with DuckDNS)
# =============================================================================
# If using DuckDNS for your domain and ports 80/443 are unavailable:
# 1. Get token from https://www.duckdns.org/
# 2. Set this token to enable DNS challenge for SSL certificates
# 3. Use docker-compose.drone.domain.yml instead of docker-compose.drone.yml
#
# Example: DUCKDNS_TOKEN=12345678-1234-1234-1234-123456789abc
# Leave empty if not using DuckDNS DNS challenge:
DUCKDNS_TOKEN=

# DRONE_ROUTER_RULE: Traefik routing rule (IMPORTANT for custom domains)
#   - Controls which requests are routed to Drone CI
#   - Prevents certificate conflicts when multiple services run on the same server
#
# ⚠️  CRITICAL: For custom domains, ALWAYS set this to Host(`your-domain`)
#     Without this, Traefik will try to generate certificates for ANY domain
#     that accesses your server, causing certificate conflicts with other services.
#
# For custom domain (REQUIRED for production):
#   Set this value exactly as shown.
#   Note: The backticks (`) are literal characters, not shell command substitution.
#   Use single quotes when setting via echo to preserve them:
#     echo 'DRONE_ROUTER_RULE=Host(`drone.yourdomain.com`)' >> .env.drone
#   Or set directly:
#     DRONE_ROUTER_RULE=Host(`drone.yourdomain.com`)
#
# For localhost/IP access only (development):
#   Leave empty to use default: PathPrefix(`/`)
#
# Default (localhost/IP access):
DRONE_ROUTER_RULE=

# =============================================================================
# Database Configuration
# =============================================================================
# PostgreSQL credentials for Drone's database

DRONE_POSTGRES_USER=drone
DRONE_POSTGRES_PASSWORD=change-this-secure-password
DRONE_POSTGRES_DB=drone

# =============================================================================
# Optional: User Management
# =============================================================================

# Auto-create admin user (format: username:admin-token,admin:true)
# Leave empty to manually approve users via UI
# Example: DRONE_USER_CREATE=username:your-github-username,admin:true
DRONE_USER_CREATE=

# Close registration (require admin approval for new users)
# Set to 'true' for private Drone instance
DRONE_REGISTRATION_CLOSED=false

# =============================================================================
# Optional: Runner Configuration
# =============================================================================

# Maximum number of concurrent pipelines
DRONE_RUNNER_CAPACITY=2

# Runner name (for identification when using multiple runners)
DRONE_RUNNER_NAME=docker-runner

# =============================================================================
# Optional: Logging and Debugging
# =============================================================================

# Enable debug logs (useful for troubleshooting)
DRONE_LOGS_DEBUG=false
DRONE_LOGS_TRACE=false
DRONE_DEBUG=false
DRONE_TRACE=false

# =============================================================================
# Port Configuration (Reference Only - Not Environment Variables)
# =============================================================================
# These are the actual ports used:
#   - Drone Server UI: 8080 (mapped to container port 80)
#   - Drone Runner:    Internal only, no exposed ports
#   - PostgreSQL:      Internal only (port 5432)
#   
# NoteHub uses port 80, so Drone uses 8080 to avoid conflicts.
# Both can run on the same VPS server without issues.
# =============================================================================

# =============================================================================
# Production Recommendations
# =============================================================================
# For production deployments:
# 
# 1. Use HTTPS with a reverse proxy:
#    - nginx, Caddy, or Traefik
#    - Set DRONE_SERVER_PROTO=https
#    - Update DRONE_SERVER_HOST to your domain
# 
# 2. Secure your secrets:
#    - Use strong passwords for PostgreSQL
#    - Generate a strong RPC secret
#    - Never commit .env.drone to version control
# 
# 3. Restrict access:
#    - Set DRONE_REGISTRATION_CLOSED=true
#    - Use DRONE_USER_CREATE to create admin user
#    - Approve users manually via UI
# 
# 4. Monitor resources:
#    - Adjust DRONE_RUNNER_CAPACITY based on server resources
#    - Monitor disk space for build artifacts
#    - Set up log rotation
# =============================================================================
