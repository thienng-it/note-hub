# =============================================================================
# Graylog Environment Configuration - INDEPENDENT
# =============================================================================
# Copy this file to .env.graylog and fill in your values:
#   cp .env.graylog.example .env.graylog
#
# ⚠️  IMPORTANT: This configuration is COMPLETELY INDEPENDENT
#
# This file (.env.graylog) is SEPARATE from .env and .env.drone
# NO variables are shared with NoteHub, Drone CI, or any other application
# Graylog has its own configuration and can be deployed independently
# Can be used with or without other applications present
# Can be deployed on a completely different server
#
# Setup Instructions:
# 1. Copy this file to .env.graylog
# 2. Generate password secret (96 characters): pwgen -N 1 -s 96
#    Or use: openssl rand -base64 96 | tr -d '\n'
# 3. Set your admin password and generate SHA2 hash:
#    echo -n "your-admin-password" | shasum -a 256
#    Or use online tool: https://emn178.github.io/online-tools/sha256.html
# 4. Configure external URI for your server
# 5. Run: docker compose --env-file .env.graylog -f docker-compose.graylog.yml up -d
# =============================================================================

# =============================================================================
# Required Configuration
# =============================================================================

# Password Secret (REQUIRED - 96 characters minimum)
# Generate with: pwgen -N 1 -s 96
# Or: openssl rand -base64 96 | tr -d '\n'
# IMPORTANT: Keep this secret secure! Used for encrypting passwords
GRAYLOG_PASSWORD_SECRET=CHANGE_ME_GENERATE_WITH_PWGEN_OR_OPENSSL_96_CHARS_MIN

# Root User Password (REQUIRED - SHA2 hash)
# 1. Choose a strong password
# 2. Generate SHA2 hash: echo -n "yourpassword" | shasum -a 256
# Example result: 8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918
GRAYLOG_ROOT_PASSWORD_SHA2=CHANGE_ME_SHA2_HASH_OF_YOUR_ADMIN_PASSWORD

# Root Username (default: admin)
GRAYLOG_ROOT_USERNAME=admin

# Root Email (for notifications)
GRAYLOG_ROOT_EMAIL=admin@example.com

# Root Timezone (for log timestamps)
# Examples: UTC, America/New_York, Europe/London, Asia/Tokyo
GRAYLOG_ROOT_TIMEZONE=UTC

# =============================================================================
# MongoDB Configuration
# =============================================================================
# MongoDB credentials for Graylog metadata storage

GRAYLOG_MONGODB_USER=graylog
GRAYLOG_MONGODB_PASSWORD=change-this-secure-mongodb-password

# =============================================================================
# OpenSearch Configuration
# =============================================================================
# OpenSearch password (must be at least 8 characters)

GRAYLOG_OPENSEARCH_PASSWORD=change-this-secure-opensearch-password

# =============================================================================
# HTTP/Web UI Configuration
# =============================================================================

# External URI for accessing Graylog web interface
# IMPORTANT: This must match how users access Graylog
# 
# Examples:
#   - Local testing:        http://localhost:9000/
#   - Production (IP):      http://123.45.67.89:9000/
#   - Production (domain):  http://logs.yourdomain.com:9000/
#   - With reverse proxy:   https://logs.yourdomain.com/
#
# Note: Include trailing slash (/)
GRAYLOG_HTTP_EXTERNAL_URI=http://localhost:9000/

# =============================================================================
# Performance Configuration (Optional)
# =============================================================================

# Number of processor threads for processing messages
# Recommendation: Set to number of CPU cores
GRAYLOG_PROCESSBUFFER_PROCESSORS=5

# Number of threads for writing messages to storage
# Recommendation: Set to 1/3 of processbuffer processors
GRAYLOG_OUTPUTBUFFER_PROCESSORS=3

# =============================================================================
# Email Configuration (Optional)
# =============================================================================
# Configure email settings for alerts and notifications
# Leave disabled if you don't need email alerts

# Enable/disable email transport
GRAYLOG_TRANSPORT_EMAIL_ENABLED=false

# SMTP Server Configuration
GRAYLOG_TRANSPORT_EMAIL_HOSTNAME=smtp.gmail.com
GRAYLOG_TRANSPORT_EMAIL_PORT=587
GRAYLOG_TRANSPORT_EMAIL_USE_AUTH=true
GRAYLOG_TRANSPORT_EMAIL_USE_TLS=true

# SMTP Credentials
GRAYLOG_TRANSPORT_EMAIL_USERNAME=your-email@gmail.com
GRAYLOG_TRANSPORT_EMAIL_PASSWORD=your-app-specific-password

# From Email Address
GRAYLOG_TRANSPORT_EMAIL_FROM_EMAIL=graylog@yourdomain.com

# =============================================================================
# Port Configuration (Reference Only - Not Environment Variables)
# =============================================================================
# These are the actual ports used:
#   - Graylog Web UI: 9000 (mapped to container port 9000)
#   - GELF UDP Input: 12201 (for receiving logs via GELF protocol)
#   - GELF TCP Input: 12201 (for receiving logs via GELF protocol)
#   - MongoDB:        Internal only (port 27017)
#   - OpenSearch:     Internal only (port 9200)
#   
# NoteHub uses port 80/443, Drone uses 8080/8443, Graylog uses 9000/12201.
# All three can run on the same VPS server without port conflicts.
# =============================================================================

# =============================================================================
# Security Best Practices
# =============================================================================
# For production deployments:
# 
# 1. Use strong passwords:
#    - Password secret should be 96+ random characters
#    - MongoDB and OpenSearch passwords should be strong
#    - Root admin password should be strong and unique
# 
# 2. Never commit .env.graylog to version control:
#    - Contains sensitive credentials
#    - Add to .gitignore if not already present
# 
# 3. Secure access:
#    - Use HTTPS with reverse proxy (nginx/Traefik) for production
#    - Restrict network access to Graylog ports using firewall
#    - Use strong authentication for all users
# 
# 4. Monitor resources:
#    - Graylog requires at least 4GB RAM for the full stack
#    - Monitor disk space for log storage (OpenSearch)
#    - Set up log retention policies to manage storage
# 
# 5. Regular maintenance:
#    - Backup MongoDB data regularly (metadata)
#    - Set up index rotation in Graylog
#    - Monitor OpenSearch cluster health
#    - Update Graylog stack regularly for security patches
# =============================================================================

# =============================================================================
# Integration with NoteHub (Optional)
# =============================================================================
# To send NoteHub logs to Graylog:
# 
# 1. Configure Graylog Input:
#    - Log in to Graylog UI: http://your-server:9000
#    - Go to System → Inputs
#    - Select "GELF UDP" or "GELF TCP" from dropdown
#    - Click "Launch new input"
#    - Set title (e.g., "NoteHub Logs")
#    - Leave bind address as 0.0.0.0
#    - Port: 12201
#    - Click "Save"
# 
# 2. Configure NoteHub backend to send logs:
#    Add to NoteHub's .env file:
#    GRAYLOG_ENABLED=true
#    GRAYLOG_HOST=localhost
#    GRAYLOG_PORT=12201
#    GRAYLOG_PROTOCOL=udp
#    
#    The backend will automatically send structured logs to Graylog.
# 
# 3. View logs in Graylog:
#    - Go to Search in Graylog UI
#    - Logs from NoteHub will appear with proper structure
#    - Use Graylog's powerful search and filtering capabilities
# =============================================================================
