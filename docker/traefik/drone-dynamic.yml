# =============================================================================
# Traefik Dynamic Configuration for Drone CI
# =============================================================================
# This configuration defines middlewares specific to Drone CI
# =============================================================================

http:
  middlewares:
    # Compression middleware
    compression-drone:
      compress:
        excludedContentTypes:
          - text/event-stream
        minResponseBodyBytes: 1024

    # Security headers middleware for Drone (with HTTPS enhancements)
    security-headers-drone:
      headers:
        frameDeny: true
        contentTypeNosniff: true
        browserXssFilter: true
        referrerPolicy: "strict-origin-when-cross-origin"
        customFrameOptionsValue: "SAMEORIGIN"
        # Force HTTPS with HSTS (HTTP Strict Transport Security)
        stsSeconds: 31536000
        stsIncludeSubdomains: true
        # IMPORTANT: HSTS preload is a PERMANENT action that cannot be easily reversed
        # Only enable this if you want to submit your domain to browser HSTS preload lists
        # This requires manual submission and affects all users of your domain forever
        stsPreload: false
        # Additional security headers for HTTPS
        forceSTSHeader: true
        contentSecurityPolicy: "upgrade-insecure-requests"

    # Body size limit for Drone artifacts
    body-size-drone:
      buffering:
        maxRequestBodyBytes: 104857600  # 100MB for build artifacts
