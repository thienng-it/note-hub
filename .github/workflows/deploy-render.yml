name: Deploy to Render

on:
  push:
    branches: ["main"]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Verify deployment files
        run: |
          echo "‚úÖ Checking deployment files..."
          test -f Procfile && echo "‚úÖ Procfile found"
          test -f requirements.txt && echo "‚úÖ requirements.txt found"
          test -f runtime.txt && echo "‚úÖ runtime.txt found"
          test -f simple_app.py && echo "‚úÖ simple_app.py found"

      - name: Deploy to Render
        if: ${{ secrets.RENDER_DEPLOY_HOOK }}
        run: |
          echo "üöÄ Deploying to Render..."
          curl -X POST "${{ secrets.RENDER_DEPLOY_HOOK }}"
          echo ""
          echo "‚úÖ Deployment triggered!"
          echo "üìç Your app will be deployed at: https://note-hub.onrender.com"

      - name: Setup deployment instructions
        if: ${{ !secrets.RENDER_DEPLOY_HOOK }}
        run: |
          echo "‚ö†Ô∏è RENDER_DEPLOY_HOOK not configured"
          echo ""
          echo "üìã Setup Instructions:"
          echo "1. Go to https://render.com and sign up"
          echo "2. Create a new Web Service"
          echo "3. Connect your GitHub repository"
          echo "4. Set Build Command: pip install -r requirements.txt"
          echo "5. Set Start Command: gunicorn simple_app:app"
          echo "6. Add Environment Variables:"
          echo "   - NOTES_ADMIN_USERNAME: admin"
          echo "   - NOTES_ADMIN_PASSWORD: your-secure-password"
          echo "   - FLASK_SECRET: your-secret-key"
          echo "7. Copy the Deploy Hook URL from Render"
          echo "8. Go to GitHub Repo ‚Üí Settings ‚Üí Secrets ‚Üí New repository secret"
          echo "9. Name: RENDER_DEPLOY_HOOK, Value: paste the hook URL"
          echo ""
          echo "After setup, every push to main will auto-deploy! üéâ"
