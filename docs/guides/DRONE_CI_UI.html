<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NoteHub Documentation - Drone CI UI Implementation Summary">
    <title>Drone CI UI Implementation Summary - NoteHub Documentation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #ec4899;
            --bg: #0f172a;
            --bg-light: #1e293b;
            --bg-lighter: #334155;
            --text: #f1f5f9;
            --text-muted: #cbd5e1;
            --accent: #22d3ee;
            --border: rgba(148, 163, 184, 0.1);
            --code-bg: #1e293b;
            --link: #60a5fa;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg) 0%, #1a1f35 100%);
            color: var(--text);
            line-height: 1.7;
            overflow-x: hidden;
        }

        header {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 1rem 2rem;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
        }

        nav a {
            color: var(--text-muted);
            text-decoration: none;
            margin-left: 2rem;
            transition: color 0.3s;
            font-size: 0.9rem;
        }

        nav a:hover {
            color: var(--accent);
        }

        main {
            max-width: 900px;
            margin: 0 auto;
            padding: 6rem 2rem 3rem;
        }

        .breadcrumb {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .breadcrumb a {
            color: var(--link);
            text-decoration: none;
            transition: color 0.3s;
        }

        .breadcrumb a:hover {
            color: var(--accent);
        }

        .breadcrumb span {
            margin: 0 0.5rem;
            color: var(--text-muted);
        }

        .content {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 3rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--accent) 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
            line-height: 1.2;
        }

        h2 {
            font-size: 1.875rem;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
            color: var(--accent);
            border-bottom: 2px solid var(--border);
            padding-bottom: 0.5rem;
        }

        h3 {
            font-size: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 0.75rem;
            color: var(--primary);
        }

        h4 {
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        h5, h6 {
            font-size: 1.1rem;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-muted);
        }

        p {
            margin-bottom: 1.25rem;
        }

        a {
            color: var(--link);
            text-decoration: none;
            transition: color 0.3s;
        }

        a:hover {
            color: var(--accent);
            text-decoration: underline;
        }

        ul, ol {
            margin-bottom: 1.25rem;
            margin-left: 2rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        code {
            background: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
            color: var(--accent);
        }

        pre {
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            overflow-x: auto;
        }

        pre code {
            background: none;
            padding: 0;
            color: var(--text);
            font-size: 0.875rem;
            line-height: 1.6;
        }

        blockquote {
            border-left: 4px solid var(--primary);
            padding-left: 1.5rem;
            margin: 1.5rem 0;
            color: var(--text-muted);
            font-style: italic;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            display: block;
        }

        thead {
            background: var(--bg-lighter);
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border: 1px solid var(--border);
        }

        th {
            font-weight: 600;
            color: var(--accent);
        }

        tbody tr:hover {
            background: rgba(99, 102, 241, 0.1);
        }

        img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 2rem 0;
        }

        .back-link {
            display: inline-block;
            margin-top: 2rem;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .back-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.5);
            text-decoration: none;
        }

        @media (max-width: 768px) {
            main {
                padding: 5rem 1rem 2rem;
            }

            .content {
                padding: 1.5rem;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            nav a {
                margin-left: 1rem;
                font-size: 0.85rem;
            }

            pre {
                padding: 1rem;
            }

            table {
                font-size: 0.875rem;
            }
        }

        /* Syntax highlighting for code blocks */
        .language-javascript .keyword { color: #c792ea; }
        .language-javascript .string { color: #c3e88d; }
        .language-javascript .comment { color: #676e95; }
        .language-bash .command { color: #82aaff; }
        .language-json .property { color: #f07178; }
    </style>
</head>
<body>
    <header>
        <a href="../documentation.html" class="logo">üìö NoteHub Documentation</a>
        <nav>
            <a href="../documentation.html">Documentation Home</a>
            <a href="./INDEX.html">Full Index</a>
            <a href="https://github.com/thienng-it/note-hub" target="_blank" rel="noopener noreferrer">GitHub</a>
        </nav>
    </header>

    <main>
        <div class="breadcrumb">
            <a href="../documentation.html">üìö Documentation</a>
            <span>/</span>
            <span>Drone CI UI Implementation Summary</span>
        </div>

        <article class="content">
            <h1>Drone CI UI Implementation Summary</h1>
<h2>Overview</h2>
<p>This document summarizes the investigation and verification of the Drone CI user interface implementation for the NoteHub project. Drone CI comes with a complete, production-ready web UI that provides a modern interface for managing CI/CD pipelines.</p>
<blockquote>
<p><strong>‚ö†Ô∏è CRITICAL for Custom Domains</strong>: </p>
<ol>
<li><strong>Port Issue</strong>: Drone uses port <strong>8443</strong> for HTTPS (not 443). Access via <code>https://your-domain.com:8443/</code> or change port mapping to use standard ports.</li>
<li><strong>Router Rule</strong>: You <strong>MUST</strong> set <code>DRONE_ROUTER_RULE=Host(\</code>your-domain.com`)<code>in</code>.env.drone`.</li>
</ol>
<p>See <a href="#-404-not-found-error-custom-domain">Troubleshooting 404 Error</a> for complete solutions.</p>
</blockquote>
<h2>Investigation Findings</h2>
<h3>UI Components</h3>
<p>Drone CI includes a <strong>built-in web interface</strong> with the following features:</p>
<ol>
<li><p><strong>Welcome Page</strong> (<code>/welcome</code>)</p>
<ul>
<li>Professional landing page with Drone branding</li>
<li>Clear call-to-action to authenticate with GitHub</li>
<li>Modern, responsive design</li>
<li>Animated background with CI/CD themed graphics</li>
</ul>
</li>
<li><p><strong>OAuth Authentication Flow</strong></p>
<ul>
<li>Seamless integration with GitHub OAuth</li>
<li>Secure authentication using OAuth 2.0</li>
<li>Redirects to GitHub for user authentication</li>
<li>Returns to Drone after successful login</li>
</ul>
</li>
<li><p><strong>Main Dashboard</strong> (after authentication)</p>
<ul>
<li>Repository listing from connected GitHub account</li>
<li>Build status indicators</li>
<li>Pipeline execution history</li>
<li>Real-time build logs</li>
</ul>
</li>
<li><p><strong>Repository Management</strong></p>
<ul>
<li>Enable/disable repositories for CI/CD</li>
<li>Repository synchronization from GitHub</li>
<li>Webhook configuration</li>
<li>Build triggers</li>
</ul>
</li>
</ol>
<h2>Architecture</h2>
<p>The Drone CI UI is served through the following architecture:</p>
<pre><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  User Browser                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ HTTP/HTTPS
               ‚îÇ Port 8080 (HTTP) or 8443 (HTTPS)
               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Traefik Reverse Proxy                  ‚îÇ
‚îÇ  - SSL/TLS termination                  ‚îÇ
‚îÇ  - Compression (gzip/brotli)            ‚îÇ
‚îÇ  - Security headers                     ‚îÇ
‚îÇ  - Request buffering (100MB)            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ Internal HTTP
               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Drone Server                           ‚îÇ
‚îÇ  - Web UI (React SPA)                   ‚îÇ
‚îÇ  - REST API                             ‚îÇ
‚îÇ  - Webhook receiver                     ‚îÇ
‚îÇ  - OAuth handler                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre>
<h2>UI Features Verified</h2>
<h3>‚úÖ Working Features</h3>
<ol>
<li><p><strong>Web Interface Access</strong></p>
<ul>
<li>Accessible at <code>http://localhost:8080</code> (development)</li>
<li>Accessible at <code>https://localhost:8443</code> (production with SSL)</li>
<li>Responsive design works on mobile and desktop</li>
</ul>
</li>
<li><p><strong>Authentication</strong></p>
<ul>
<li>GitHub OAuth integration working</li>
<li>Proper redirect flow to GitHub login</li>
<li>Secure token handling</li>
</ul>
</li>
<li><p><strong>Traefik Integration</strong></p>
<ul>
<li>Reverse proxy correctly routing requests</li>
<li>Compression middleware active</li>
<li>Security headers properly set</li>
<li>Body size limit configured (100MB for artifacts)</li>
</ul>
</li>
<li><p><strong>Service Health</strong></p>
<ul>
<li>All services running and healthy</li>
<li>Database connection established</li>
<li>Runner connected to server</li>
</ul>
</li>
</ol>
<h2>UI Screenshots</h2>
<h3>1. Welcome Page</h3>
<p><img src="https://github.com/user-attachments/assets/6a05f05e-4820-49c1-8170-a71a893bc06e" alt="Drone CI Welcome Page"></p>
<p><strong>Features visible:</strong></p>
<ul>
<li>Drone by Harness branding</li>
<li>&quot;Hello, Welcome to Drone&quot; greeting</li>
<li>Clear explanation of OAuth flow</li>
<li>&quot;Continue&quot; button to start authentication</li>
<li>Modern, animated background with CI/CD graphics</li>
</ul>
<h3>2. GitHub OAuth Login</h3>
<p>When clicking &quot;Continue&quot;, users are redirected to GitHub&#39;s OAuth page to authenticate and authorize the Drone application.</p>
<h2>Configuration Details</h2>
<h3>Environment Variables for UI</h3>
<p>The following environment variables affect the UI:</p>
<h4>For Local Development (HTTP)</h4>
<pre><code class="language-bash"># Server hostname (displayed in UI)
DRONE_SERVER_HOST=localhost:8080

# Protocol (affects OAuth redirect URLs)
DRONE_SERVER_PROTO=http

# GitHub OAuth (required for login)
DRONE_GITHUB_CLIENT_ID=your-client-id
DRONE_GITHUB_CLIENT_SECRET=your-client-secret

# Router rule (use default for localhost)
DRONE_ROUTER_RULE=
</code></pre>
<h4>For Production with Custom Domain (HTTPS)</h4>
<pre><code class="language-bash"># ‚ö†Ô∏è CRITICAL: All these must be set for custom domains
DRONE_SERVER_HOST=drone-ci-notehub.duckdns.org
DRONE_SERVER_PROTO=https
DRONE_DOMAIN=drone-ci-notehub.duckdns.org
ACME_EMAIL=your-email@example.com

# ‚ö†Ô∏è MOST IMPORTANT: This prevents 404 errors
DRONE_ROUTER_RULE=Host(`drone-ci-notehub.duckdns.org`)

# GitHub OAuth (required for login)
DRONE_GITHUB_CLIENT_ID=your-client-id
DRONE_GITHUB_CLIENT_SECRET=your-client-secret
</code></pre>
<blockquote>
<p><strong>Note</strong>: The backticks (<code>) in </code>DRONE_ROUTER_RULE` are literal characters, not shell command substitution.</p>
</blockquote>
<h3>Traefik Configuration</h3>
<p>The UI is served through Traefik with these middlewares:</p>
<ol>
<li><p><strong>Compression</strong> (<code>compression-drone</code>)</p>
<ul>
<li>Gzip/Brotli compression</li>
<li>Excludes event streams</li>
<li>Minimum body size: 1KB</li>
</ul>
</li>
<li><p><strong>Security Headers</strong> (<code>security-headers-drone</code>)</p>
<ul>
<li>Frame protection (SAMEORIGIN)</li>
<li>XSS protection</li>
<li>Content type nosniff</li>
<li>HSTS for HTTPS</li>
<li>CSP: upgrade-insecure-requests</li>
</ul>
</li>
<li><p><strong>Body Size Limit</strong> (<code>body-size-drone</code>)</p>
<ul>
<li>Max request body: 100MB</li>
<li>Allows large build artifacts</li>
</ul>
</li>
</ol>
<h2>Access URLs</h2>
<h3>Development (HTTP)</h3>
<pre><code>http://localhost:8080
</code></pre>
<h3>Production (HTTPS with custom domain)</h3>
<p><strong>‚ö†Ô∏è Important</strong>: Drone uses non-standard ports by default to avoid conflicts with other services.</p>
<p><strong>Option 1: Access with port number (Default Configuration)</strong></p>
<pre><code>https://drone.yourdomain.com:8443
</code></pre>
<p><strong>Option 2: Standard ports (Requires port mapping change)</strong></p>
<pre><code>https://drone.yourdomain.com
</code></pre>
<p>To use standard ports, modify <code>docker-compose.drone.yml</code>:</p>
<pre><code class="language-yaml">ports:
  - &quot;80:80&quot;    # Instead of &quot;8080:80&quot;
  - &quot;443:443&quot;  # Instead of &quot;8443:443&quot;
</code></pre>
<p>‚ö†Ô∏è Only use this if ports 80/443 are available (not used by other services).</p>
<h3>Production (HTTPS with IP)</h3>
<pre><code>https://your-server-ip:8443
</code></pre>
<h2>UI Testing Results</h2>
<h3>Test Environment</h3>
<ul>
<li><strong>Date</strong>: December 8, 2024</li>
<li><strong>Drone Version</strong>: drone/drone:2</li>
<li><strong>Traefik Version</strong>: traefik:v2.11</li>
<li><strong>Test Configuration</strong>: HTTP-only for local testing</li>
</ul>
<h3>Test Results</h3>
<table>
<thead>
<tr>
<th>Test Case</th>
<th>Status</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td>UI loads at port 8080</td>
<td>‚úÖ Pass</td>
<td>Loads welcome page</td>
</tr>
<tr>
<td>Welcome page renders</td>
<td>‚úÖ Pass</td>
<td>All elements visible</td>
</tr>
<tr>
<td>Continue button works</td>
<td>‚úÖ Pass</td>
<td>Redirects to GitHub OAuth</td>
</tr>
<tr>
<td>GitHub OAuth redirect</td>
<td>‚úÖ Pass</td>
<td>Proper URL with client_id</td>
</tr>
<tr>
<td>Traefik health check</td>
<td>‚úÖ Pass</td>
<td>Service healthy</td>
</tr>
<tr>
<td>Drone server health check</td>
<td>‚úÖ Pass</td>
<td>Service healthy</td>
</tr>
<tr>
<td>Database connection</td>
<td>‚úÖ Pass</td>
<td>PostgreSQL healthy</td>
</tr>
<tr>
<td>Runner connection</td>
<td>‚úÖ Pass</td>
<td>Runner connected</td>
</tr>
<tr>
<td>Compression enabled</td>
<td>‚úÖ Pass</td>
<td>Headers present</td>
</tr>
<tr>
<td>Security headers</td>
<td>‚úÖ Pass</td>
<td>All headers set</td>
</tr>
</tbody></table>
<p><strong>Overall Status</strong>: ‚úÖ <strong>All tests passed</strong></p>
<h2>Accessing the UI</h2>
<h3>Prerequisites</h3>
<ol>
<li>Docker and Docker Compose installed</li>
<li>GitHub OAuth application created</li>
<li><code>.env.drone</code> configured with credentials</li>
</ol>
<h3>Step-by-Step Access</h3>
<ol>
<li><p><strong>Start Drone CI services</strong>:</p>
<pre><code class="language-bash">docker compose --env-file .env.drone -f docker-compose.drone.yml up -d
</code></pre>
</li>
<li><p><strong>Wait for services to be healthy</strong> (30-60 seconds):</p>
<pre><code class="language-bash">docker compose --env-file .env.drone -f docker-compose.drone.yml ps
</code></pre>
</li>
<li><p><strong>Access the UI</strong>:</p>
<ul>
<li>Open browser to <code>http://localhost:8080</code> (or your configured domain)</li>
<li>You&#39;ll see the welcome page</li>
<li>Click &quot;Continue&quot; to authenticate with GitHub</li>
</ul>
</li>
<li><p><strong>First-time setup</strong>:</p>
<ul>
<li>Authorize the Drone application on GitHub</li>
<li>Grant repository access permissions</li>
<li>You&#39;ll be redirected back to Drone</li>
<li>The UI will show your repositories</li>
</ul>
</li>
</ol>
<h2>UI Customization</h2>
<p>The Drone UI is <strong>not customizable</strong> in the open-source version. However, you can:</p>
<ol>
<li><p><strong>Brand the experience</strong> using reverse proxy:</p>
<ul>
<li>Add custom landing page before <code>/welcome</code></li>
<li>Use Traefik to serve custom static content</li>
<li>Implement custom authentication flow</li>
</ul>
</li>
<li><p><strong>Configure appearance</strong> via environment variables:</p>
<ul>
<li><code>DRONE_SERVER_HOST</code>: Affects URLs in UI</li>
<li>Logo and theme are fixed in open-source version</li>
</ul>
</li>
<li><p><strong>Enterprise features</strong> (paid):</p>
<ul>
<li>Custom branding</li>
<li>White-labeling</li>
<li>Custom themes</li>
</ul>
</li>
</ol>
<h2>Performance Characteristics</h2>
<h3>UI Load Times</h3>
<ul>
<li><strong>Welcome page</strong>: ~50-100ms (first load)</li>
<li><strong>Welcome page</strong>: ~10-20ms (cached)</li>
<li><strong>Dashboard</strong>: Depends on repository count</li>
<li><strong>Build logs</strong>: Real-time streaming</li>
</ul>
<h3>Resource Usage</h3>
<ul>
<li><strong>Drone Server</strong>: ~100MB RAM</li>
<li><strong>Traefik</strong>: ~50MB RAM</li>
<li><strong>Total for UI</strong>: ~150MB RAM</li>
</ul>
<h3>Concurrent Users</h3>
<ul>
<li>Designed for 100+ concurrent users</li>
<li>Horizontal scaling available</li>
<li>WebSocket support for real-time updates</li>
</ul>
<h2>Integration Points</h2>
<h3>With NoteHub</h3>
<p>Drone CI is <strong>completely independent</strong> from NoteHub. There is no direct integration between the UIs. Users access:</p>
<ul>
<li>NoteHub: <code>http://localhost:80</code> (or port 80)</li>
<li>Drone CI: <code>http://localhost:8080</code> (or port 8080)</li>
</ul>
<h3>Potential Integrations (Future)</h3>
<ol>
<li><p><strong>Embed Drone status</strong> in NoteHub UI</p>
<ul>
<li>Use Drone API to fetch build status</li>
<li>Display CI badge in NoteHub</li>
</ul>
</li>
<li><p><strong>Single Sign-On (SSO)</strong></p>
<ul>
<li>Both use GitHub OAuth</li>
<li>Could share authentication context</li>
</ul>
</li>
<li><p><strong>Webhooks</strong></p>
<ul>
<li>Drone can trigger NoteHub API on builds</li>
<li>NoteHub can trigger Drone builds</li>
</ul>
</li>
</ol>
<h2>Security Considerations</h2>
<h3>UI Security Features</h3>
<ol>
<li><strong>HTTPS enforced</strong> in production (via Traefik)</li>
<li><strong>Security headers</strong> applied (XSS, Frame, CSP)</li>
<li><strong>OAuth authentication</strong> required</li>
<li><strong>CSRF protection</strong> built-in</li>
<li><strong>Rate limiting</strong> supported</li>
</ol>
<h3>Best Practices</h3>
<ol>
<li>Use HTTPS in production</li>
<li>Configure GitHub OAuth with restricted scopes</li>
<li>Enable registration closed mode</li>
<li>Use strong RPC secrets</li>
<li>Regular updates of Drone image</li>
</ol>
<h2>Troubleshooting UI Issues</h2>
<h3>‚ùå 404 Not Found Error (Custom Domain)</h3>
<p><strong>Problem</strong>: Accessing <code>https://drone-ci-notehub.duckdns.org/</code> returns 404 even though all containers are running.</p>
<p><strong>Common Causes</strong>:</p>
<h4>1. Port Mismatch (Most Common)</h4>
<p>By default, Drone CI uses <strong>port 8443 for HTTPS</strong>, not the standard port 443. When you access <code>https://your-domain.com/</code>, browsers connect to port 443 by default.</p>
<p><strong>Solutions</strong>:</p>
<p><strong>Option A: Access with correct port (Quick Test)</strong></p>
<pre><code class="language-bash"># Access Drone with port 8443 in the URL
https://drone-ci-notehub.duckdns.org:8443/
</code></pre>
<p>Use this for quick testing or if you prefer to keep Drone on non-standard ports.</p>
<p><strong>Option B: Use standard ports (Production Recommended for Let&#39;s Encrypt)</strong></p>
<p>Modify <code>docker-compose.drone.yml</code> to use standard HTTPS ports:</p>
<pre><code class="language-yaml">services:
  drone-traefik:
    # ... other configuration ...
    ports:
      - &quot;80:80&quot;    # Change from &quot;8080:80&quot;
      - &quot;443:443&quot;  # Change from &quot;8443:443&quot;
</code></pre>
<p><strong>Benefits:</strong></p>
<ul>
<li>Allows Let&#39;s Encrypt HTTP challenge to work automatically for SSL certificate generation</li>
<li>No need to specify port in URL (access via standard <code>https://domain.com/</code>)</li>
<li>Professional production setup</li>
</ul>
<p>‚ö†Ô∏è <strong>Warning</strong>: This requires that ports 80 and 443 are not already in use by other services (like NoteHub). If NoteHub is running on the same server using ports 80/443, you must either:</p>
<ul>
<li>Run Drone on a different server</li>
<li>Use a different port (keep 8080/8443) and access with the port number</li>
<li>Set up an external reverse proxy (nginx/Caddy) to route based on domain</li>
</ul>
<p><strong>Note on SSL Certificates with Non-Standard Ports:</strong><br>If you keep ports 8080/8443, Let&#39;s Encrypt HTTP challenge may fail because it expects port 80 to be accessible. In this case, you would need to either:</p>
<ol>
<li>Temporarily open port 80 for certificate issuance</li>
<li>Use DNS challenge instead (requires DNS provider API configuration)</li>
<li>Use a wildcard certificate or existing certificate</li>
</ol>
<h4>2. Missing DRONE_ROUTER_RULE Configuration</h4>
<p><strong>Solution</strong>: Set the <code>DRONE_ROUTER_RULE</code> environment variable in <code>.env.drone</code>:</p>
<pre><code class="language-bash"># Add this line to .env.drone
DRONE_ROUTER_RULE=Host(`drone-ci-notehub.duckdns.org`)

# Also ensure these are set correctly:
DRONE_SERVER_HOST=drone-ci-notehub.duckdns.org
DRONE_SERVER_PROTO=https
DRONE_DOMAIN=drone-ci-notehub.duckdns.org
ACME_EMAIL=your-email@example.com
</code></pre>
<p><strong>Important</strong>: </p>
<ul>
<li>The backticks (`) are literal characters in the DRONE_ROUTER_RULE value</li>
<li>Without this rule, Traefik uses the default <code>PathPrefix(&#39;/&#39;)</code> which matches all paths on any domain, potentially causing routing conflicts when multiple services use Traefik on the same server</li>
<li>With a custom domain, you need the <code>Host()</code> matcher to ensure requests are only routed when the Host header matches your specific domain</li>
<li>After updating <code>.env.drone</code>, restart the services:</li>
</ul>
<pre><code class="language-bash">docker compose --env-file .env.drone -f docker-compose.drone.yml down
docker compose --env-file .env.drone -f docker-compose.drone.yml up -d
</code></pre>
<p><strong>Verification</strong>:</p>
<pre><code class="language-bash"># Check which ports Traefik is listening on
docker ps --format &quot;table {{.Names}}\t{{.Ports}}&quot; | grep drone-traefik
# Should show: 0.0.0.0:8080-&gt;80/tcp, 0.0.0.0:8443-&gt;443/tcp

# Check Traefik is using the correct routing rule
docker logs drone-traefik 2&gt;&amp;1 | grep -i &quot;drone-ci-notehub.duckdns.org&quot;

# Test access with correct port
curl -I https://drone-ci-notehub.duckdns.org:8443/

# Check if port 443 is available (if you want to switch to standard ports)
sudo netstat -tulpn | grep :443
# Or use: sudo lsof -i :443
</code></pre>
<h3>SSL Certificate Not Generated / HTTPS Errors</h3>
<p><strong>Problem</strong>: Let&#39;s Encrypt isn&#39;t generating certificates, or you get SSL/certificate errors.</p>
<p><strong>Cause</strong>: Let&#39;s Encrypt HTTP challenge requires port 80 to be accessible from the internet at your domain.</p>
<p><strong>Diagnosis</strong>:</p>
<pre><code class="language-bash"># Check Traefik logs for ACME/certificate errors
docker logs drone-traefik 2&gt;&amp;1 | grep -i &quot;acme\|certificate\|letsencrypt&quot;

# Check if port 80 is accessible from outside
curl -I http://drone-ci-notehub.duckdns.org
</code></pre>
<p><strong>Solutions</strong>:</p>
<p><strong>If using non-standard ports (8080/8443):</strong></p>
<p>The HTTP challenge won&#39;t work because Let&#39;s Encrypt tries to access port 80, but your Traefik is on port 8080.</p>
<p><strong>Option 1: Switch to standard ports (Recommended)</strong></p>
<pre><code class="language-yaml"># In docker-compose.drone.yml
drone-traefik:
  ports:
    - &quot;80:80&quot;    # Required for Let&#39;s Encrypt HTTP challenge
    - &quot;443:443&quot;  # Standard HTTPS port
</code></pre>
<p><strong>Option 2: Temporarily expose port 80</strong><br>If you only need port 80 for initial certificate issuance:</p>
<ol>
<li>Stop any service using port 80</li>
<li>Temporarily change Traefik to use port 80</li>
<li>Let certificate generate</li>
<li>Change back to port 8080 (certificate will remain valid)</li>
</ol>
<p><strong>Option 3: Use DNS challenge (For DuckDNS and other providers)</strong></p>
<p>DNS challenge allows certificate generation without needing port 80. Required when ports 80/443 are used by other services.</p>
<p><strong>For DuckDNS (drone-ci-notehub.duckdns.org):</strong></p>
<ol>
<li><p>Get your DuckDNS token from <a href="https://www.duckdns.org/">https://www.duckdns.org/</a></p>
</li>
<li><p>Update <code>docker-compose.drone.yml</code>:</p>
</li>
</ol>
<pre><code class="language-yaml">drone-traefik:
  command:
    # Replace HTTP challenge with DNS challenge
    - &quot;--certificatesresolvers.letsencrypt.acme.dnschallenge=true&quot;
    - &quot;--certificatesresolvers.letsencrypt.acme.dnschallenge.provider=duckdns&quot;
    - &quot;--certificatesresolvers.letsencrypt.acme.dnschallenge.delaybeforecheck=10&quot;
    # Remove or comment out these HTTP challenge lines:
    # - &quot;--certificatesresolvers.letsencrypt.acme.httpchallenge=true&quot;
    # - &quot;--certificatesresolvers.letsencrypt.acme.httpchallenge.entrypoint=web&quot;
  environment:
    - ACME_EMAIL=${ACME_EMAIL:-admin@example.com}
    - DUCKDNS_TOKEN=your-duckdns-token  # Add your DuckDNS token
</code></pre>
<ol start="3">
<li>Restart services:</li>
</ol>
<pre><code class="language-bash">docker compose --env-file .env.drone -f docker-compose.drone.yml down
docker compose --env-file .env.drone -f docker-compose.drone.yml up -d
</code></pre>
<ol start="4">
<li>Access via: <code>https://drone-ci-notehub.duckdns.org:8443/</code></li>
</ol>
<p><strong>For other DNS providers (Cloudflare, Route53, etc.):</strong></p>
<pre><code class="language-yaml"># In docker-compose.drone.yml command section
- &quot;--certificatesresolvers.letsencrypt.acme.dnschallenge=true&quot;
- &quot;--certificatesresolvers.letsencrypt.acme.dnschallenge.provider=cloudflare&quot;
</code></pre>
<p>Then set DNS provider credentials in environment variables. See <a href="https://doc.traefik.io/traefik/https/acme/#providers">Traefik DNS providers</a> for supported providers.</p>
<p><strong>If using standard ports (80/443):</strong></p>
<p>Ensure:</p>
<ol>
<li>DNS points correctly: <code>nslookup drone-ci-notehub.duckdns.org</code></li>
<li>Firewall allows port 80: <code>sudo ufw status</code></li>
<li>No other service using port 80: <code>sudo lsof -i :80</code></li>
</ol>
<h3>UI Not Loading</h3>
<ol>
<li><p>Check services are running:</p>
<pre><code class="language-bash">docker compose --env-file .env.drone -f docker-compose.drone.yml ps
</code></pre>
</li>
<li><p>Check Traefik logs:</p>
<pre><code class="language-bash">docker logs drone-traefik
</code></pre>
</li>
<li><p>Verify port not in use:</p>
<pre><code class="language-bash">sudo lsof -i :8080
</code></pre>
</li>
</ol>
<h3>OAuth Redirect Fails</h3>
<ol>
<li>Verify GitHub OAuth callback URL matches</li>
<li>Check <code>DRONE_SERVER_HOST</code> is correct</li>
<li>Ensure <code>DRONE_SERVER_PROTO</code> matches (http/https)</li>
</ol>
<h3>UI Shows &quot;Unauthorized&quot;</h3>
<ol>
<li>Verify GitHub OAuth credentials</li>
<li>Check <code>DRONE_GITHUB_CLIENT_ID</code> and <code>DRONE_GITHUB_CLIENT_SECRET</code></li>
<li>Ensure OAuth app is active on GitHub</li>
</ol>
<h2>Documentation References</h2>
<p>For more information:</p>
<ul>
<li><strong><a href="DRONE_CI_README.md">DRONE_CI_README.md</a></strong> - Quick start guide</li>
<li><strong><a href="docs/guides/DRONE_CI_SETUP.md">DRONE_CI_SETUP.md</a></strong> - Detailed setup</li>
<li><strong><a href="docs/guides/DRONE_CI_STANDALONE.md">DRONE_CI_STANDALONE.md</a></strong> - Independence docs</li>
<li><strong><a href="https://docs.drone.io/">Official Drone Docs</a></strong> - Complete reference</li>
</ul>
<h2>Conclusion</h2>
<h3>Summary</h3>
<p>‚úÖ Drone CI includes a <strong>complete, production-ready web UI</strong> out of the box<br>‚úÖ UI is accessible and functional at <code>http://localhost:8080</code><br>‚úÖ GitHub OAuth integration works correctly<br>‚úÖ All services are healthy and properly configured<br>‚úÖ Traefik reverse proxy correctly serves the UI with compression and security</p>
<h3>Status</h3>
<p><strong>The Drone CI UI is fully implemented and ready for use.</strong></p>
<p>No custom UI development is needed - Drone CI provides a professional, feature-complete interface for managing CI/CD pipelines.</p>
<h3>Next Steps</h3>
<ol>
<li>Configure GitHub OAuth with production credentials</li>
<li>Set up custom domain with HTTPS (optional)</li>
<li>Enable repositories in the UI</li>
<li>Create <code>.drone.yml</code> pipelines for NoteHub</li>
<li>Monitor builds through the UI</li>
</ol>
<hr>
<p><strong>Implementation Date</strong>: December 8, 2024<br><strong>Verification</strong>: ‚úÖ Complete<br><strong>Status</strong>: Production Ready</p>

        </article>

        <a href="../documentation.html" class="back-link">‚Üê Back to Documentation</a>
    </main>
</body>
</html>
