# =============================================================================
# Docker Compose Override for Local Development
# =============================================================================
#
# This file disables registry cache and optimizes for local development.
# 
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.local.yml up -d
#
# Or set COMPOSE_FILE environment variable:
#   export COMPOSE_FILE=docker-compose.yml:docker-compose.local.yml
#   docker compose up -d
#
# This override:
#   - Removes cache_from/cache_to to avoid registry warnings
#   - Keeps BuildKit cache mounts (faster local builds)
#   - Maintains all other optimizations
#
# Note: Due to Docker Compose merge behavior, we cannot simply override cache
# directives. Instead, we define a complete build section without cache.
# =============================================================================

# Define a reusable build config without cache for backend
x-backend-build-local: &backend-build-local
  context: .
  dockerfile: Dockerfile.backend.node

# Define a reusable build config without cache for frontend
x-frontend-build-local: &frontend-build-local
  context: .
  dockerfile: Dockerfile.frontend.traefik
  args:
    - VITE_API_URL=

# Define a reusable build config without cache for frontend-prod
x-frontend-prod-build-local: &frontend-prod-build-local
  context: .
  dockerfile: Dockerfile.frontend.traefik
  args:
    - VITE_API_URL=${VITE_API_URL:-}

services:
  # Frontend - Remove registry cache
  frontend:
    build: *frontend-build-local

  # Backend - Remove registry cache
  backend:
    build: *backend-build-local

  # Frontend Production - Remove registry cache
  frontend-prod:
    build: *frontend-prod-build-local

  # Backend Production - Remove registry cache
  backend-prod:
    build: *backend-build-local

  # Backend MySQL - Remove registry cache
  backend-mysql:
    build: *backend-build-local

  # Frontend MySQL - Remove registry cache
  frontend-mysql:
    build: *frontend-build-local
